import{c as g,a as S,j as d}from"./jsx-runtime-DzeBifHW.js";import{u as y,a as p,M as b,c as N,b as E}from"./use-suspense-DTYBca5u.js";import{u as m,a as x}from"./use-ref-effect-CG-PCi_3.js";import{b as A}from"./core-abL_lBWD.js";function h(e,o,c,s){return e.addEventListener(o,c,s),()=>e.removeEventListener(o,c)}function v(e,o){const[c,s]=m([]);return x(()=>{const{current:n}=e;if(!n)return;const i=()=>s(n.assignedNodes().filter(t=>!(t instanceof b)&&(o?o(t):!0)));return i(),h(n,"slotchange",i)},[e]),c}function Y(e,o){const c=y(),s=v(e,o),[n,i]=m(s),t=r=>r.parentElement===c.current;return p(()=>{s.length&&i([...n,...s].filter(t))},s),p(()=>{if(!n.length)return;const r=new Set(n.map(a=>a.assignedSlot));r.delete(e.current);const u=[...r].map(a=>h(a,"slotchange",()=>i(f=>{const l=f.filter(t);return f.length===l.length?f:l})));return()=>u.map(a=>a())},n),n}const O=N(function({array:e}){const[o,c]=m([]),s=E(),n=Y(s,t=>t instanceof HTMLElement);p(()=>{e&&(console.debug("YArray:useEffect",{array:e.toJSON()}),c(e.toJSON()),e.observe(t=>{console.log("YArray:observe",{events:t,array:e.toJSON()}),c(e?.toJSON())}))},[e]);function i(t,r){return console.log("YArray:getSharedProps",{Template:t,item:r}),t.getAttributeNames().filter(u=>u.startsWith(":")).reduce((u,a)=>{const f=a.replace(":",""),l=t.getAttribute(a);return u[f]=typeof l>"u"||l==="item"?r:r instanceof Object&&r[l],u},{})}return S("host",{shadowDom:!0,children:[d("template",{children:d("slot",{ref:s})}),o.map((t,r)=>n.map((u,a)=>d(u,{cloneNode:!0,...i(u,t)})))]})},{props:{array:{type:A,reflect:!1}},styles:g`:host{display:block}`});customElements.define("y-array",O);export{O as Y};
